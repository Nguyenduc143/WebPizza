<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza Shop - Chi Ti·∫øt S·∫£n Ph·∫©m</title>
    <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/product-detail.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html" class="logo-link"><h1>üçï Pizza Shop</h1></a>
                </div>
                <nav class="nav-menu">
                    <ul>
                        <li><a href="index.html">Trang Ch·ªß</a></li>
                        <li><a href="menu.html" class="active">Menu</a></li>
                        <li><a href="cart.html">Gi·ªè H√†ng <span class="cart-count" id="cartCount">0</span></a></li>
                        <li><a href="contact.html">Li√™n H·ªá</a></li>
                        <li class="user-account">
                            <a href="javascript:;" id="user-account-link">
                                <span class="user-icon">üë§</span>
                                <span id="user-account-text">ƒêƒÉng Nh·∫≠p</span>
                            </a>
                            <ul class="user-dropdown" id="userDropdown" style="display: none;">
                                <li id="admin-menu-item" style="display: none;">
                                    <a href="admin.html">‚öôÔ∏è Qu·∫£n l√Ω c·ª≠a h√†ng</a>
                                </li>
                                <li id="customer-menu-item">
                                    <a href="customer.html">üìã ƒê∆°n h√†ng c·ªßa t√¥i</a>
                                </li>
                                <li><a href="javascript:;" id="btn-logout">üö™ ƒêƒÉng xu·∫•t</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <button class="search-btn" onclick="toggleSearch()">üîç</button>
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-overlay" id="searchOverlay">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="T√¨m ki·∫øm pizza..." id="searchInput">
            <button class="search-close" onclick="toggleSearch()">‚úï</button>
        </div>
    </div>

    <!-- Modal Login/Signup -->
    <div class="modal-overlay" id="authModal" style="display: none;">
        <div class="modal-auth">
            <button class="modal-close-btn" onclick="closeAuthModal()">‚úñ</button>
            
            <!-- Login Form -->
            <div class="auth-form" id="loginForm">
                <h3 class="auth-title">ƒêƒÉng Nh·∫≠p T√†i Kho·∫£n</h3>
                <p class="auth-description">ƒêƒÉng nh·∫≠p ƒë·ªÉ mua h√†ng v√† nh·∫≠n nh·ªØng ∆∞u ƒë√£i ƒë·∫∑c bi·ªát</p>
                <form onsubmit="return handleLogin(event)">
                    <div class="form-group">
                        <label>S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" id="login-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required>
                        <span class="form-error" id="login-phone-error"></span>
                    </div>
                    <div class="form-group">
                        <label>M·∫≠t kh·∫©u</label>
                        <input type="password" id="login-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                        <span class="form-error" id="login-password-error"></span>
                    </div>
                    <button type="submit" class="btn-auth">ƒêƒÉng Nh·∫≠p</button>
                </form>
                <p class="auth-switch">
                    B·∫°n ch∆∞a c√≥ t√†i kho·∫£n? <a href="javascript:;" onclick="showSignupForm()">ƒêƒÉng k√Ω ngay</a>
                </p>
            </div>

            <!-- Signup Form -->
            <div class="auth-form" id="signupForm" style="display: none;">
                <h3 class="auth-title">ƒêƒÉng K√Ω T√†i Kho·∫£n</h3>
                <p class="auth-description">ƒêƒÉng k√Ω th√†nh vi√™n ƒë·ªÉ mua h√†ng v√† nh·∫≠n ∆∞u ƒë√£i ƒë·∫∑c bi·ªát</p>
                <form onsubmit="return handleSignup(event)">
                    <div class="form-group">
                        <label>T√™n ƒë·∫ßy ƒë·ªß</label>
                        <input type="text" id="signup-fullname" placeholder="VD: Nguy·ªÖn VƒÉn A" required>
                        <span class="form-error" id="signup-fullname-error"></span>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" id="signup-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required>
                        <span class="form-error" id="signup-phone-error"></span>
                    </div>
                    <div class="form-group">
                        <label>M·∫≠t kh·∫©u</label>
                        <input type="password" id="signup-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                        <span class="form-error" id="signup-password-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
                        <input type="password" id="signup-password-confirm" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required>
                        <span class="form-error" id="signup-password-confirm-error"></span>
                    </div>
                    <div class="form-group-checkbox">
                        <input type="checkbox" id="signup-agree" required>
                        <label for="signup-agree">T√¥i ƒë·ªìng √Ω v·ªõi ch√≠nh s√°ch v√† ƒëi·ªÅu kho·∫£n</label>
                    </div>
                    <button type="submit" class="btn-auth">ƒêƒÉng K√Ω</button>
                </form>
                <p class="auth-switch">
                    B·∫°n ƒë√£ c√≥ t√†i kho·∫£n? <a href="javascript:;" onclick="showLoginForm()">ƒêƒÉng nh·∫≠p ngay</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Breadcrumb -->
    <section class="breadcrumb-section">
        <div class="container">
            <nav class="breadcrumb">
                <a href="index.html">Trang Ch·ªß</a>
                <span>/</span>
                <a href="menu.html">Menu</a>
                <span>/</span>
                <span id="breadcrumbProductName">Chi Ti·∫øt S·∫£n Ph·∫©m</span>
            </nav>
        </div>
    </section>

    <!-- Product Detail -->
    <section class="product-detail-section">
        <div class="container">
            <div class="product-detail-wrapper" id="productDetailWrapper">
                <!-- Content will be loaded by JavaScript -->
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    <section class="related-products-section">
        <div class="container">
            <h2 class="section-title">S·∫£n Ph·∫©m Li√™n Quan</h2>
            <div class="products-grid" id="relatedProducts">
                <!-- Related products will be loaded by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>üçï Pizza Shop</h3>
                    <p>Ch√∫ng t√¥i ph·ª•c v·ª• nh·ªØng chi·∫øc pizza ngon nh·∫•t v·ªõi nguy√™n li·ªáu t∆∞∆°i s·∫°ch v√† c√¥ng th·ª©c truy·ªÅn th·ªëng √ù.</p>
                </div>
                <div class="footer-col">
                    <h4>Li√™n k·∫øt nhanh</h4>
                    <ul>
                        <li><a href="index.html">Trang Ch·ªß</a></li>
                        <li><a href="menu.html">Menu</a></li>
                        <li><a href="contact.html">Li√™n H·ªá</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Gi·ªù m·ªü c·ª≠a</h4>
                    <p>Th·ª© 2 - Th·ª© 6: 10:00 - 22:00</p>
                    <p>Th·ª© 7 - CN: 09:00 - 23:00</p>
                </div>
                <div class="footer-col">
                    <h4>Li√™n h·ªá</h4>
                    <p>üìç 123 ƒê∆∞·ªùng Pizza, Qu·∫≠n 1, TP.HCM</p>
                    <p>üìû (028) 1234 5678</p>
                    <p>‚úâÔ∏è info@pizzashop.vn</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Pizza Shop. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        // Load product detail
        document.addEventListener('DOMContentLoaded', function() {
            loadProductDetail();
            updateCartCount();
            checkCurrentUser();
        });

        function loadProductDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get('id'));
            
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                document.getElementById('productDetailWrapper').innerHTML = `
                    <div class="product-not-found">
                        <h2>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h2>
                        <p>S·∫£n ph·∫©m b·∫°n ƒëang t√¨m ki·∫øm kh√¥ng t·ªìn t·∫°i.</p>
                        <a href="menu.html" class="btn btn-primary">Quay l·∫°i Menu</a>
                    </div>
                `;
                return;
            }
            
            // Update breadcrumb
            document.getElementById('breadcrumbProductName').textContent = product.name;
            document.title = `Pizza Shop - ${product.name}`;
            
// Render product detail
            const wrapper = document.getElementById('productDetailWrapper');
            wrapper.innerHTML = `
                <div class="product-gallery">
                    <div class="main-image">
                        <img src="${product.image}" alt="${product.name}" id="mainProductImage">
                    </div>
                    <div class="image-badge">
                        <span class="badge-featured">‚≠ê Ph·ªï bi·∫øn</span>
                    </div>
                </div>
                <div class="product-detail-info">
                    <div class="product-header">
                        <h1 class="product-title">${product.name}</h1>
                        <div class="product-rating">
                            <span class="stars">${getStarRating(product.rating || 4.5)}</span>
                            <span class="rating-value">${product.rating || 4.5}</span>
                            <span class="review-count">(${product.reviews || 100} ƒë√°nh gi√°)</span>
                        </div>
                    </div>
                    
                    <div class="product-price-section">
                        <span class="current-price">${formatPrice(product.price)}</span>
                        <span class="price-note">Gi√° c∆° b·∫£n</span>
                    </div>
                    
                    <div class="product-description">
                        <h3>M√¥ t·∫£</h3>
                        <p>${product.fullDescription || product.description}</p>
                    </div>
                    
                    <div class="product-ingredients">
                        <h3>Th√†nh ph·∫ßn</h3>
                        <div class="ingredients-list">
                            ${(product.ingredients || ['Ph√¥ mai', 'S·ªët c√† chua', 'ƒê·∫ø b√°nh']).map(ing => `<span class="ingredient-tag">${ing}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="product-sizes">
                        <h3>Ch·ªçn k√≠ch th∆∞·ªõc</h3>
                        <div class="size-options">
                            ${(product.sizes || [
                                { name: "Nh·ªè (20cm)", price: product.price },
                                { name: "V·ª´a (25cm)", price: product.price + 100000 },
                                { name: "L·ªõn (30cm)", price: product.price + 200000 }
                            ]).map((size, index) => `
                                <label class="size-option ${index === 0 ? 'active' : ''}">
                                    <input type="radio" name="size" value="${size.price}" ${index === 0 ? 'checked' : ''} onchange="updateSelectedPrice(${size.price})">
                                    <span class="size-name">${size.name}</span>
                                    <span class="size-price">${formatPrice(size.price)}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="product-quantity">
                        <h3>S·ªë l∆∞·ª£ng</h3>
                        <div class="quantity-selector">
                            <button class="qty-btn" onclick="changeQuantity(-1)">‚àí</button>
                            <input type="number" id="productQuantity" value="1" min="1" max="10">
                            <button class="qty-btn" onclick="changeQuantity(1)">+</button>
                        </div>
                    </div>
                    
                    <div class="product-actions">
                        <button class="btn btn-primary btn-add-cart" onclick="addToCartFromDetail(${product.id})">
                            üõí Th√™m v√†o gi·ªè h√†ng
                        </button>
                        <button class="btn btn-outline btn-buy-now" onclick="buyNow(${product.id})">
                            ‚ö° Mua ngay
                        </button>
                    </div>
                    
                    <div class="product-nutrition">
                        <h3>Th√¥ng tin dinh d∆∞·ª°ng (m·ªói ph·∫ßn)</h3>
                        <div class="nutrition-grid">
                            <div class="nutrition-item">
                                <span class="nutrition-value">${product.nutrition?.calories || 280}</span>
                                <span class="nutrition-label">Calories</span>
                            </div>
                            <div class="nutrition-item">
                                <span class="nutrition-value">${product.nutrition?.protein || 15}g</span>
                                <span class="nutrition-label">Protein</span>
                            </div>
                            <div class="nutrition-item">
                                <span class="nutrition-value">${product.nutrition?.carbs || 32}g</span>
                                <span class="nutrition-label">Carbs</span>
                            </div>
                            <div class="nutrition-item">
                                <span class="nutrition-value">${product.nutrition?.fat || 14}g</span>
                                <span class="nutrition-label">Ch·∫•t b√©o</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load related products
            loadRelatedProducts(product);
        }

        function getStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '‚≠ê';
            }
            if (hasHalfStar && fullStars < 5) {
                stars += '‚ú®';
            }
            
            return stars;
        }

        function updateSelectedPrice(price) {
            document.querySelectorAll('.size-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.target.closest('.size-option').classList.add('active');
        }

        function changeQuantity(delta) {
            const input = document.getElementById('productQuantity');
            let value = parseInt(input.value) + delta;
            if (value < 1) value = 1;
            if (value > 10) value = 10;
            input.value = value;
        }

        function addToCartFromDetail(productId) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const selectedSize = document.querySelector('input[name="size"]:checked');
            const selectedPrice = selectedSize ? parseInt(selectedSize.value) : product.price;
            
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // Check if product already in cart (same product and price)
            const existingIndex = cart.findIndex(item => item.id === productId && item.price === selectedPrice);
            
            if (existingIndex > -1) {
                cart[existingIndex].quantity += quantity;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: selectedPrice,
                    image: product.image,
                    quantity: quantity
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            
            // Show notification
            showNotification(`ƒê√£ th√™m ${quantity} ${product.name} v√†o gi·ªè h√†ng!`);
        }

        function buyNow(productId) {
            addToCartFromDetail(productId);
            window.location.href = 'cart.html';
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification-toast';
            notification.innerHTML = `
                <span class="notification-icon">‚úì</span>
                <span class="notification-message">${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function loadRelatedProducts(currentProduct) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const related = products
                .filter(p => p.id !== currentProduct.id && p.category === currentProduct.category)
                .slice(0, 4);
            
            // If not enough related products, add some from other categories
            if (related.length < 4) {
                const others = products
                    .filter(p => p.id !== currentProduct.id && p.category !== currentProduct.category)
                    .slice(0, 4 - related.length);
                related.push(...others);
            }
            
            const container = document.getElementById('relatedProducts');
            container.innerHTML = related.map(product => `
                <div class="product-card">
                    <a href="product-detail.html?id=${product.id}">
                        <img src="${product.image}" alt="${product.name}">
                    </a>
                    <div class="product-info">
                        <h3><a href="product-detail.html?id=${product.id}">${product.name}</a></h3>
                        <p>${product.description}</p>
                        <div class="product-footer">
                            <span class="price">${formatPrice(product.price)}</span>
                            <button class="btn btn-primary" onclick="addToCart(${product.id})">Th√™m</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
